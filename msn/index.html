<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>About ‚Äî MSN 2007 Chat</title>

<style>
  /* ===== Pixel-ish MSN 2007 vibe (WLM 8/2007-era inspired) ===== */
  :root{
    --font: Tahoma, "Segoe UI", Arial, sans-serif;

    --frame1:#c9d7f3;
    --frame2:#7e9bd6;
    --winBg:#eaf1ff;

    --titleTop:#3b79d8;
    --titleBot:#1e55b7;

    --chromeTop:#f7fbff;
    --chromeBot:#dbe9ff;

    --panel:#ffffff;
    --border:#9fb3de;
    --border2:#c8d6f1;

    --me:#0b57d0;
    --them:#0f7b2b;
    --sys:#7a2ea8;

    --statusOnline:#1fc15d;
    --statusBusy:#e53935;
    --statusAway:#f6a100;
    --statusOffline:#9aa7bd;

    --shadow: 0 18px 50px rgba(0,0,0,.22);

    /* DP placeholders are embedded SVGs via JS */
    --dp-me:none;
    --dp-them:none;
  }

  *{ box-sizing:border-box; }
  html, body{ height:100%; }
  body{
    margin:0;
    font-family:var(--font);
    background:
      radial-gradient(900px 600px at 25% 10%, #ffffff 0%, rgba(255,255,255,0) 60%),
      radial-gradient(900px 600px at 80% 30%, #d6e6ff 0%, rgba(214,230,255,0) 62%),
      linear-gradient(#cfe0ff, #f4f7ff);
    padding: 14px;
    display:grid;
    place-items:center;
  }

  /* Window: keep it fixed-height; scroll only inside chat log */
  .wlm{
    width: min(980px, 100%);
    height: min(88vh, 760px);
    border-radius: 10px;
    overflow:hidden;
    box-shadow: var(--shadow);
    border: 1px solid var(--frame2);
    background: linear-gradient(#f6fbff, #e3efff);
    display:flex;
    flex-direction:column;
    position:relative;
  }

  /* Titlebar */
  .titlebar{
    height: 34px;
    display:flex;
    align-items:center;
    justify-content:space-between;
    padding: 0 8px 0 10px;
    color:#fff;
    background: linear-gradient(var(--titleTop), var(--titleBot));
    border-bottom: 1px solid rgba(0,0,0,.18);
    user-select:none;
    flex: 0 0 auto;
  }
  .titlebar__left{
    display:flex;
    align-items:center;
    gap: 8px;
    min-width:0;
  }
  .wlmIcon{
    width:16px; height:16px;
    border-radius:4px;
    background:
      radial-gradient(circle at 30% 30%, #7dff8f 0 35%, transparent 36%),
      radial-gradient(circle at 72% 35%, #5dd6ff 0 35%, transparent 36%),
      radial-gradient(circle at 46% 78%, #ffd84c 0 40%, transparent 41%),
      #0a2f6f;
    border:1px solid rgba(255,255,255,.4);
    box-shadow: inset 0 1px 0 rgba(255,255,255,.25);
  }
  .titlebar__title{
    font-size: 12px;
    white-space:nowrap;
    overflow:hidden;
    text-overflow:ellipsis;
    opacity:.95;
  }
  .winBtns{ display:flex; gap:6px; }
  .winBtn{
    width: 30px; height: 20px;
    border-radius: 3px;
    border: 1px solid rgba(255,255,255,.28);
    background: rgba(255,255,255,.16);
    display:grid;
    place-items:center;
    font-size: 12px;
    line-height: 1;
    cursor:pointer;
  }
  .winBtn:hover{ background: rgba(255,255,255,.24); }
  .winBtn.close:hover{ background: rgba(255,75,75,.9); border-color: rgba(255,255,255,.35); }

  /* Menu bar (File / Edit / Actions / Help) */
  .menubar{
    height: 26px;
    display:flex;
    align-items:center;
    gap: 14px;
    padding: 0 10px;
    background: linear-gradient(var(--chromeTop), var(--chromeBot));
    border-bottom: 1px solid var(--border2);
    flex: 0 0 auto;
    color:#0b1020;
    font-size: 12px;
  }
  .menuItem{
    padding: 2px 6px;
    border-radius: 3px;
    cursor:pointer;
  }
  .menuItem:hover{
    background: rgba(125,160,220,.22);
    outline: 1px solid rgba(90,125,185,.35);
  }
  .menubar .spacer{ flex:1; }
  .dateStamp{
    font-size: 11px;
    opacity:.7;
    white-space:nowrap;
  }

  /* Conversation header strip (DP + To + status dropdown) */
  .convTop{
    padding: 8px 10px;
    background: linear-gradient(#ffffff, #f1f6ff);
    border-bottom: 1px solid var(--border2);
    display:flex;
    align-items:center;
    gap: 10px;
    flex: 0 0 auto;
  }

  .dp{
    width: 44px; height: 44px;
    border-radius: 8px;
    border: 1px solid rgba(0,0,0,.18);
    box-shadow:
      inset 0 0 0 2px rgba(255,255,255,.65),
      0 1px 0 rgba(0,0,0,.06);
    background-size: cover;
    background-position: center;
    flex: 0 0 auto;
  }
  .dp.them{ background-image: var(--dp-them); }
  .dp.me{ background-image: var(--dp-me); display:none; } /* no sidebar; we keep yours hidden */

  .toLine{
    min-width:0;
    display:flex;
    flex-direction:column;
    gap:2px;
  }
  .toLine .to{
    font-size: 12px;
    white-space:nowrap;
    overflow:hidden;
    text-overflow:ellipsis;
  }
  .toLine .sub{
    font-size: 11px;
    color: rgba(0,0,0,.58);
    white-space:nowrap;
    overflow:hidden;
    text-overflow:ellipsis;
  }

  .convTop .right{
    margin-left:auto;
    display:flex;
    align-items:center;
    gap: 10px;
  }

  /* Fake status dropdown */
  .statusWrap{
    display:flex;
    align-items:center;
    gap: 6px;
    padding: 4px 8px;
    border-radius: 999px;
    background: #fff;
    border: 1px solid var(--border2);
    box-shadow: inset 0 1px 0 rgba(255,255,255,.7);
  }
  .dot{
    width: 9px; height: 9px;
    border-radius: 50%;
    background: var(--statusOnline);
    box-shadow: 0 0 0 2px rgba(31,193,93,.16);
  }
  .statusSel{
    border:0;
    background:transparent;
    font-family:var(--font);
    font-size: 12px;
    outline:0;
    cursor:pointer;
    appearance:none;
    -webkit-appearance:none;
    -moz-appearance:none;
    padding-right: 16px;
  }
  .caret{
    margin-left: -14px;
    font-size: 10px;
    opacity:.7;
    pointer-events:none;
  }

  /* Toolbar icons row (Nudge / Buzz / Emoticons etc) */
  .toolrow{
    height: 30px;
    display:flex;
    align-items:center;
    gap: 6px;
    padding: 0 10px;
    background: linear-gradient(#fbfdff, #eaf2ff);
    border-bottom: 1px solid var(--border2);
    flex: 0 0 auto;
  }
  .toolBtn{
    height: 22px;
    border-radius: 4px;
    border: 1px solid rgba(120,150,210,.45);
    background: linear-gradient(#ffffff, #eef5ff);
    box-shadow: inset 0 1px 0 rgba(255,255,255,.7);
    font-size: 12px;
    padding: 0 8px;
    cursor:pointer;
    display:flex;
    align-items:center;
    gap: 6px;
  }
  .toolBtn:hover{ background: linear-gradient(#ffffff, #e4efff); }
  .toolBtn:active{ transform: translateY(1px); }
  .toolSep{ width: 1px; height: 18px; background: rgba(0,0,0,.12); margin: 0 4px; }

  .colorPick{
    width: 22px; height: 22px;
    padding:0;
    border-radius: 4px;
    border: 1px solid rgba(0,0,0,.16);
    background:transparent;
    cursor:pointer;
  }

  /* Chat area */
  .chat{
    flex: 1 1 auto;
    min-height: 0;
    display:flex;
    flex-direction:column;
    background: var(--panel);
  }

  .log{
    flex: 1 1 auto;
    min-height: 0;
    overflow:auto;
    padding: 10px 12px 6px;

    /* subtle MSN-ish ruled background */
    background:
      linear-gradient(#ffffff, #ffffff) padding-box,
      repeating-linear-gradient(
        to bottom,
        rgba(0,0,0,0.015) 0px,
        rgba(0,0,0,0.015) 1px,
        transparent 1px,
        transparent 24px
      );
  }

  /* MSN transcript line */
  .line{
    margin: 5px 0;
    font-size: 13px;
    line-height: 1.35;
    word-wrap:break-word;
  }
  .name{
    font-weight:700;
  }
  .name.me{ color: var(--me); }
  .name.them{ color: var(--them); }
  .name.sys{ color: var(--sys); }
  .time{
    font-size: 12px;
    opacity:.65;
    margin-left: 6px;
  }
  .say{
    opacity:.8;
    margin-left: 4px;
  }
  .msg{ color: #0b1020; }
  .sysMsg{ color: rgba(0,0,0,.6); }

  .linky{
    color: #0b57d0;
    text-decoration: underline;
  }

  /* Emoticon ‚Äúclassic‚Äù look */
  .em{
    display:inline-grid;
    place-items:center;
    width: 18px;
    height: 18px;
    border-radius: 4px;
    border: 1px solid rgba(0,0,0,.14);
    background: linear-gradient(#fff, #f1f1f1);
    box-shadow: 0 1px 0 rgba(0,0,0,.06);
    font-size: 12px;
    line-height:1;
    vertical-align: -3px;
    margin: 0 1px;
  }

  /* Typing indicator */
  .typingRow{
    display:none;
    margin: 8px 0 2px;
    font-size: 12px;
    color: rgba(0,0,0,.55);
  }
  .typingRow.on{ display:block; }
  .dots{ display:inline-flex; gap:3px; margin-left:6px; vertical-align:middle; }
  .dots i{
    width:4px; height:4px; border-radius:50%;
    background: rgba(0,0,0,.45);
    display:inline-block;
    animation: bop 1.1s infinite ease-in-out;
  }
  .dots i:nth-child(2){ animation-delay:.15s }
  .dots i:nth-child(3){ animation-delay:.3s }
  @keyframes bop{
    0%,100%{ transform: translateY(0); opacity:.45 }
    50%{ transform: translateY(-3px); opacity:1 }
  }

  /* Composer strip */
  .composer{
    border-top: 1px solid var(--border2);
    background: linear-gradient(#fbfdff, #eaf2ff);
    padding: 8px 10px;
    display:grid;
    grid-template-columns: 1fr auto;
    gap: 10px;
    flex: 0 0 auto;
    align-items:end;
  }
  .inputWrap{
    background:#fff;
    border: 1px solid var(--border2);
    border-radius: 6px;
    box-shadow: inset 0 1px 0 rgba(255,255,255,.8);
    padding: 6px;
  }
  textarea{
    width:100%;
    border:0;
    outline:0;
    resize:none;
    height: 56px;
    max-height: 140px;
    font-family: var(--font);
    font-size: 13px;
    line-height: 1.25;
  }
  .send{
    height: 34px;
    padding: 0 14px;
    border-radius: 6px;
    border: 1px solid rgba(120,150,210,.55);
    background: linear-gradient(#ffffff, #e8f1ff);
    box-shadow: inset 0 1px 0 rgba(255,255,255,.75);
    cursor:pointer;
    font-weight:700;
    font-size: 12px;
  }
  .send:hover{ background: linear-gradient(#ffffff, #dfeeff); }
  .send:active{ transform: translateY(1px); }

  /* Nudge shake */
  @keyframes nudge {
    0%,100%{ transform: translateX(0) }
    10%{ transform: translateX(-10px) }
    20%{ transform: translateX(10px) }
    30%{ transform: translateX(-8px) }
    40%{ transform: translateX(8px) }
    50%{ transform: translateX(-6px) }
    60%{ transform: translateX(6px) }
    70%{ transform: translateX(-3px) }
    80%{ transform: translateX(3px) }
  }
  .nudged{ animation: nudge .45s ease-in-out; }

  /* Mobile: fill screen */
  @media (max-width: 820px){
    body{ padding: 8px; place-items:stretch; }
    .wlm{
      width: 100%;
      height: calc(100dvh - 16px);
      border-radius: 8px;
    }
    .menubar{ gap: 10px; }
    .toolrow{ flex-wrap:wrap; height:auto; padding: 6px 10px; }
  }
  @supports not (height: 100dvh){
    @media (max-width: 820px){
      .wlm{ height: calc(100vh - 16px); }
    }
  }

  @media (prefers-reduced-motion: reduce){
    .nudged{ animation:none; }
    .dots i{ animation:none; }
  }
</style>
</head>

<body>

<div class="wlm" id="app">
  <div class="titlebar">
    <div class="titlebar__left">
      <div class="wlmIcon" aria-hidden="true"></div>
      <div class="titlebar__title">Conversation with The Website ‚Äî Windows Live Messenger</div>
    </div>
    <div class="winBtns" aria-hidden="true">
      <div class="winBtn" title="Minimize">‚Äî</div>
      <div class="winBtn" title="Maximize">‚ñ¢</div>
      <div class="winBtn close" title="Close">‚úï</div>
    </div>
  </div>

  <div class="menubar" role="menubar" aria-label="Menu">
    <div class="menuItem" role="menuitem">File</div>
    <div class="menuItem" role="menuitem">Edit</div>
    <div class="menuItem" role="menuitem">Actions</div>
    <div class="menuItem" role="menuitem">Help</div>
    <div class="spacer"></div>
    <div class="dateStamp" id="dateStamp"></div>
  </div>

  <div class="convTop">
    <div class="dp them" id="dpThem" aria-hidden="true"></div>

    <div class="toLine">
      <div class="to">To: <b>The Website</b></div>
      <div class="sub">‚ÄúA nostalgia-forward scrapbook + UI playground.‚Äù</div>
    </div>

    <div class="right">
      <div class="statusWrap" title="Status (fake)">
        <span class="dot" id="statusDot" aria-hidden="true"></span>
        <select class="statusSel" id="statusSel" aria-label="Status">
          <option value="available" selected>Available</option>
          <option value="busy">Busy</option>
          <option value="away">Away</option>
          <option value="offline">Offline</option>
        </select>
        <span class="caret" aria-hidden="true">‚ñæ</span>
      </div>
    </div>
  </div>

  <div class="toolrow" aria-label="Toolbar">
    <button class="toolBtn" type="button" id="btnNudge" title="Nudge">üì≥ Nudge</button>
    <button class="toolBtn" type="button" id="btnBuzz" title="Buzz">‚ö° Buzz</button>
    <span class="toolSep" aria-hidden="true"></span>

    <button class="toolBtn" type="button" id="btnEmotes" title="Show emoticons">üòÑ Emoticons</button>
    <button class="toolBtn" type="button" id="btnTour" title="Show allowed links">üîó /tour</button>

    <span class="toolSep" aria-hidden="true"></span>

    <label class="toolBtn" style="cursor:default;">
      üé® Font
      <input class="colorPick" id="fontColor" type="color" value="#0b57d0" title="Font colour" />
    </label>

    <div style="margin-left:auto; font-size:11px; opacity:.65;">
      Links are locked to 4 pages only.
    </div>
  </div>

  <div class="chat">
    <div class="log" id="log" aria-live="polite">
      <!-- Seed transcript -->
      <div class="line">
        <span class="name sys">System</span><span class="time">(00:01)</span><span class="say">says:</span>
        <span class="sysMsg">You are now viewing the About chat log.</span>
      </div>

      <div class="line">
        <span class="name them">The Website</span><span class="time">(00:01)</span><span class="say">says:</span>
        <span class="msg">hey ‚Äî i‚Äôm a personal site built like a set of nostalgic ‚Äúworlds‚Äù.</span>
      </div>

      <div class="line">
        <span class="name me">Lewis</span><span class="time">(00:02)</span><span class="say">says:</span>
        <span class="msg">what‚Äôs on here? :)</span>
      </div>

      <div class="line">
        <span class="name them">The Website</span><span class="time">(00:03)</span><span class="say">says:</span>
        <span class="msg">four portals ‚Äî the only links i‚Äôll give you:</span>
      </div>

      <div class="line">
        <span class="name them">The Website</span><span class="time">(00:03)</span><span class="say">says:</span>
        <span class="msg">
          ‚Ä¢ <a class="linky" href="https://lewis.lc/diary">lewis.lc/diary</a><br>
          ‚Ä¢ <a class="linky" href="https://lewis.lc/myspace">lewis.lc/myspace</a><br>
          ‚Ä¢ <a class="linky" href="https://lewis.lc/livejournal">lewis.lc/livejournal</a><br>
          ‚Ä¢ <a class="linky" href="https://lewis.lc/retro">lewis.lc/retro</a>
        </span>
      </div>

      <div class="line">
        <span class="name me">Lewis</span><span class="time">(00:04)</span><span class="say">says:</span>
        <span class="msg">so it‚Äôs an internet scrapbook + UI playground?</span>
      </div>

      <div class="line">
        <span class="name them">The Website</span><span class="time">(00:04)</span><span class="say">says:</span>
        <span class="msg">exactly. part archive. part cosplay. part ‚Äúwhat if 2007 never ended‚Äù. :D</span>
      </div>

      <div class="typingRow" id="typingRow">
        <span class="name them">The Website</span> is typing
        <span class="dots" aria-hidden="true"><i></i><i></i><i></i></span>
      </div>
    </div>

    <form class="composer" id="form">
      <div class="inputWrap">
        <textarea id="input" placeholder="Type a message‚Ä¶ (Enter to send, Shift+Enter for new line)"></textarea>
      </div>
      <button class="send" type="submit">Send</button>
    </form>
  </div>
</div>

<script>
  // ===== Lock links to ONLY these 4 URLs =====
  const LINKS = {
    diary: "https://lewis.lc/diary",
    myspace: "https://lewis.lc/myspace",
    livejournal: "https://lewis.lc/livejournal",
    retro: "https://lewis.lc/retro"
  };
  const ALLOWED = new Set(Object.values(LINKS));

  // ===== Royalty-free placeholder DPs: embedded SVG data-URIs (original) =====
  const svgToDataUri = (svg) => `url("data:image/svg+xml;charset=UTF-8,${encodeURIComponent(svg)}")`;

  const dpThemSVG = `
  <svg xmlns="http://www.w3.org/2000/svg" width="160" height="160">
    <defs>
      <linearGradient id="g2" x1="0" y1="0" x2="1" y2="1">
        <stop offset="0" stop-color="#ffd7e8"/>
        <stop offset="1" stop-color="#d7e9ff"/>
      </linearGradient>
      <filter id="s2" x="-20%" y="-20%" width="140%" height="140%">
        <feDropShadow dx="0" dy="5" stdDeviation="6" flood-color="#000" flood-opacity=".18"/>
      </filter>
    </defs>
    <rect width="160" height="160" rx="24" fill="url(#g2)"/>
    <path d="M18 108 C44 76, 86 70, 144 108 L144 152 L18 152 Z" fill="#ffffff" opacity=".88" filter="url(#s2)"/>
    <circle cx="78" cy="66" r="36" fill="#ffffff" opacity=".94" filter="url(#s2)"/>
    <circle cx="66" cy="70" r="6" fill="#0b1020" opacity=".52"/>
    <circle cx="92" cy="70" r="6" fill="#0b1020" opacity=".52"/>
    <path d="M62 88 Q78 100 94 88" fill="none" stroke="#0b1020" stroke-opacity=".35" stroke-width="6" stroke-linecap="round"/>
    <path d="M120 22 L150 44 L132 62 L104 40 Z" fill="#ffffff" opacity=".28"/>
  </svg>`;

  const dpMeSVG = `
  <svg xmlns="http://www.w3.org/2000/svg" width="160" height="160">
    <defs>
      <linearGradient id="g" x1="0" y1="0" x2="1" y2="1">
        <stop offset="0" stop-color="#b9ffcc"/>
        <stop offset="1" stop-color="#b2d8ff"/>
      </linearGradient>
      <filter id="s" x="-20%" y="-20%" width="140%" height="140%">
        <feDropShadow dx="0" dy="5" stdDeviation="6" flood-color="#000" flood-opacity=".18"/>
      </filter>
    </defs>
    <rect width="160" height="160" rx="24" fill="url(#g)"/>
    <circle cx="82" cy="64" r="34" fill="#ffffff" opacity=".94" filter="url(#s)"/>
    <rect x="34" y="104" width="92" height="44" rx="22" fill="#ffffff" opacity=".88" filter="url(#s)"/>
    <circle cx="70" cy="62" r="6" fill="#0b1020" opacity=".55"/>
    <circle cx="94" cy="62" r="6" fill="#0b1020" opacity=".55"/>
    <path d="M70 78 Q82 92 94 78" fill="none" stroke="#0b1020" stroke-opacity=".42" stroke-width="6" stroke-linecap="round"/>
  </svg>`;

  document.documentElement.style.setProperty("--dp-them", svgToDataUri(dpThemSVG));
  document.documentElement.style.setProperty("--dp-me", svgToDataUri(dpMeSVG));
  document.getElementById("dpThem").style.backgroundImage = svgToDataUri(dpThemSVG);

  // ===== Date stamp (top right) =====
  const dateStamp = document.getElementById("dateStamp");
  dateStamp.textContent = new Date().toLocaleString(undefined, {
    weekday: "short", year: "numeric", month: "short", day: "numeric"
  });

  // ===== Elements =====
  const app = document.getElementById("app");
  const log = document.getElementById("log");
  const form = document.getElementById("form");
  const input = document.getElementById("input");
  const typingRow = document.getElementById("typingRow");
  const fontColor = document.getElementById("fontColor");

  // ===== Time helper =====
  const pad2 = (n) => String(n).padStart(2, "0");
  const timeNow = () => {
    const d = new Date();
    return `${pad2(d.getHours())}:${pad2(d.getMinutes())}`;
  };

  // ===== Escape HTML =====
  const escapeHTML = (str) =>
    str.replace(/[&<>"']/g, (m) => ({
      "&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#039;"
    }[m]));

  // ===== Emoticons -> tiny classic badges =====
  const EMOTES = [
    { re: /(^|\s):\)/g,  html: '$1<span class="em" title=":)">üôÇ</span>' },
    { re: /(^|\s):D/g,   html: '$1<span class="em" title=":D">üòÑ</span>' },
    { re: /(^|\s);\)/g,  html: '$1<span class="em" title=";)">üòâ</span>' },
    { re: /(^|\s):\(/g,  html: '$1<span class="em" title=":(">üôÅ</span>' },
    { re: /(^|\s):P/gi,  html: '$1<span class="em" title=":P">üòõ</span>' },
    { re: /<3/g,         html: '<span class="em" title="<3">‚ù§Ô∏è</span>' },
    { re: /:\|/g,        html: '<span class="em" title=":|">üòê</span>' }
  ];

  function sanitizeAndFormat(text){
    let out = escapeHTML(text).replace(/\n/g, "<br>");

    // lock outgoing URLs:
    const urlRe = /(https?:\/\/[^\s<]+)/g;
    out = out.replace(urlRe, (m) => {
      if (ALLOWED.has(m)) return `<a class="linky" href="${m}">${m.replace("https://","")}</a>`;
      return m; // show as plain text if not allowed
    });

    // emotes
    EMOTES.forEach(({re, html}) => out = out.replace(re, html));
    return out;
  }

  function setTyping(on){
    typingRow.classList.toggle("on", !!on);
    if (on) log.scrollTop = log.scrollHeight;
  }

  function addLine({ who="me", html="", isSystem=false }){
    const div = document.createElement("div");
    div.className = "line";

    const whoClass = isSystem ? "sys" : (who === "me" ? "me" : "them");
    const whoLabel = isSystem ? "System" : (who === "me" ? "Lewis" : "The Website");
    const msgClass = isSystem ? "sysMsg" : "msg";

    const userColorStyle = (who === "me" && !isSystem) ? `style="color:${fontColor.value}"` : "";

    div.innerHTML = `
      <span class="name ${whoClass}" ${userColorStyle}>${whoLabel}</span>
      <span class="time">(${timeNow()})</span><span class="say">says:</span>
      <span class="${msgClass}" ${userColorStyle}>${html}</span>
    `;

    log.insertBefore(div, typingRow);
    log.scrollTop = log.scrollHeight;
  }

  // ===== Pixel-ish nudge =====
  function nudge(){
    app.classList.remove("nudged");
    void app.offsetWidth;
    app.classList.add("nudged");
  }

  // ===== ‚ÄúBot‚Äù replies (only uses your 4 links) =====
  function linkHTML(key){
    const url = LINKS[key];
    return `<a class="linky" href="${url}">${url.replace("https://","")}</a>`;
  }

  function replyTo(userText){
    const t = userText.trim().toLowerCase();

    if (t === "/help"){
      addLine({ who:"them", html: sanitizeAndFormat("commands: /tour, /about, /why, /emotes") });
      return;
    }
    if (t === "/tour"){
      addLine({ who:"them", html:
        `pick a portal:<br>
         ‚Ä¢ ${linkHTML("diary")}<br>
         ‚Ä¢ ${linkHTML("myspace")}<br>
         ‚Ä¢ ${linkHTML("livejournal")}<br>
         ‚Ä¢ ${linkHTML("retro")}` });
      return;
    }
    if (t === "/about"){
      addLine({ who:"them", html: sanitizeAndFormat("a nostalgia-forward personal site: diary pages, faux-social profiles, and retro UI experiments.") });
      return;
    }
    if (t === "/why"){
      addLine({ who:"them", html: sanitizeAndFormat("because the old web had personality. this is a scrapbook + a UI playground.") });
      return;
    }
    if (t === "/emotes"){
      addLine({ who:"them", html: sanitizeAndFormat("emotes: :) :D ;) :( :P <3 :|  (you can add more in EMOTES[])") });
      return;
    }

    if (t.includes("diary"))       { addLine({ who:"them", html: `diary ‚Üí ${linkHTML("diary")}` }); return; }
    if (t.includes("myspace"))     { addLine({ who:"them", html: `myspace ‚Üí ${linkHTML("myspace")}` }); return; }
    if (t.includes("livejournal") || t.includes("lj")){
      addLine({ who:"them", html: `livejournal ‚Üí ${linkHTML("livejournal")}` }); return;
    }
    if (t.includes("retro"))       { addLine({ who:"them", html: `retro ‚Üí ${linkHTML("retro")}` }); return; }

    addLine({ who:"them", html: sanitizeAndFormat("try /tour for links, or ask about diary / myspace / livejournal / retro.") });
  }

  // ===== Submit =====
  form.addEventListener("submit", (e) => {
    e.preventDefault();
    const text = input.value.trim();
    if (!text) return;

    addLine({ who:"me", html: sanitizeAndFormat(text) });
    input.value = "";

    setTyping(true);
    setTimeout(() => {
      setTyping(false);
      replyTo(text);
    }, 650);
  });

  input.addEventListener("keydown", (e) => {
    if (e.key === "Enter" && !e.shiftKey){
      e.preventDefault();
      form.requestSubmit();
    }
  });

  // ===== Toolbar buttons =====
  document.getElementById("btnNudge").addEventListener("click", () => {
    addLine({ who:"me", html: sanitizeAndFormat("*nudge*") });
    nudge();
    setTyping(true);
    setTimeout(() => {
      setTyping(false);
      addLine({ who:"them", html: sanitizeAndFormat("OI!! :(") });
    }, 600);
  });

  document.getElementById("btnBuzz").addEventListener("click", () => {
    addLine({ who:"me", html: sanitizeAndFormat("BUZZ!!!") });
    nudge(); setTimeout(nudge, 120);
    setTyping(true);
    setTimeout(() => {
      setTyping(false);
      addLine({ who:"them", html: sanitizeAndFormat("stoppppp :(") });
    }, 650);
  });

  document.getElementById("btnTour").addEventListener("click", () => {
    addLine({ who:"me", html: sanitizeAndFormat("/tour") });
    setTyping(true);
    setTimeout(() => { setTyping(false); replyTo("/tour"); }, 420);
  });

  document.getElementById("btnEmotes").addEventListener("click", () => {
    addLine({ who:"them", html: sanitizeAndFormat("emotes: :) :D ;) :( :P <3 :|") });
  });

  // ===== Status dropdown behaviour =====
  const statusSel = document.getElementById("statusSel");
  const statusDot = document.getElementById("statusDot");

  const STATUS = {
    available: { label:"Available", color:"var(--statusOnline)", glow:"rgba(31,193,93,.16)" },
    busy:      { label:"Busy",      color:"var(--statusBusy)",   glow:"rgba(229,57,53,.16)" },
    away:      { label:"Away",      color:"var(--statusAway)",   glow:"rgba(246,161,0,.16)" },
    offline:   { label:"Offline",   color:"var(--statusOffline)",glow:"rgba(154,167,189,.16)" }
  };

  function resolveVar(cssVar){
    // cssVar like "var(--statusOnline)"
    const m = cssVar.match(/--[^)]+/);
    if (!m) return cssVar;
    return getComputedStyle(document.documentElement).getPropertyValue(m[0]).trim();
    }
  function applyStatus(key){
    const s = STATUS[key] || STATUS.available;
    statusDot.style.background = resolveVar(s.color);
    statusDot.style.boxShadow = `0 0 0 2px ${s.glow}`;
    addLine({ who:"sys", isSystem:true, html: sanitizeAndFormat(`Status set to "${s.label}".`) });
  }
  statusSel.addEventListener("change", () => applyStatus(statusSel.value));

  // Ensure seeded emoticons render:
  document.querySelectorAll(".line .msg").forEach(el => {
    el.innerHTML = sanitizeAndFormat(el.textContent);
  });

  // Start scrolled to bottom
  log.scrollTop = log.scrollHeight;
</script>

</body>
</html>
