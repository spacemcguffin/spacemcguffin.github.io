<!doctype html>
<html lang="en" class="no-js">
<head>
  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">

  <link href="https://fonts.googleapis.com/css2?family=Parkinsans:wght@300..800&display=swap" rel="stylesheet">
  <link href="https://fonts.googleapis.com/css2?family=Inter:ital,opsz,wght@0,14..32,100..900;1,14..32,100..900&display=swap" rel="stylesheet">
  <link href="https://fonts.googleapis.com/css2?family=Onest:wght@200;300;400;500;600;700;800&amp;display=swap" rel="stylesheet">
  <link href="https://fonts.googleapis.com/css2?family=Poppins:ital,wght@0,100;0,200;0,300;0,400;0,500;0,600;0,700;0,800;0,900;1,100;1,200;1,300;1,400;1,500;1,600;1,700;1,800;1,900&amp;display=swap" rel="stylesheet">
  <link href="https://fonts.googleapis.com/css2?family=Bebas+Neue&amp;display=swap" rel="stylesheet">
  <link href="https://fonts.googleapis.com/css2?family=Geist:wght@100..900&display=swap" rel="stylesheet">

  <link rel="stylesheet" href="https://unicons.iconscout.com/release/v4.0.8/css/line.css">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">

  <title>South Park</title>
  <meta name="description" content="">

  <!-- (optional) keep your existing css if you have it -->
  <!-- <link rel="stylesheet" href="guide.css"> -->
    <link rel="stylesheet" href="guide.css">
  
  <!-- ✅ Dark mode + sticky chips + 3-col max grid + inline stars + search hide class -->
  <style>
    :root{
      --bg0:#070712;
      --bg1:#0b1020;
      --panel: rgba(255,255,255,.06);
      --panel2: rgba(255,255,255,.10);
      --border: rgba(255,255,255,.12);
      --text: rgba(255,255,255,.92);
      --muted: rgba(255,255,255,.62);
      --shadow: 0 18px 45px rgba(0,0,0,.55);
      --shadow2: 0 10px 25px rgba(0,0,0,.40);
      --radius:18px;
    }

    body{
      background:
        radial-gradient(1200px 800px at 10% -10%, rgba(139,92,246,.22), transparent 55%),
        radial-gradient(900px 600px at 90% 10%, rgba(34,211,238,.18), transparent 55%),
        linear-gradient(180deg, var(--bg0), var(--bg1));
      color: var(--text);
    }

    /* Sticky chips bar */
    .guide-sticky{
      position: sticky;
      top: 0;
      z-index: 50;
      background: rgba(7,7,18,.72);
      backdrop-filter: blur(14px);
      -webkit-backdrop-filter: blur(14px);
      border-bottom: 1px solid var(--border);
    }
    .guide-sticky .inner{
      max-width: 1180px;
      margin: 0 auto;
      padding: 12px 16px;
      display: grid;
      gap: 10px;
    }
    .guide-tools{
      display:flex;
      gap:10px;
      align-items:center;
      flex-wrap:wrap;
    }
    .guide-search{
      flex:1;
      min-width:240px;
      display:flex;
      align-items:center;
      gap:10px;
      padding:10px 12px;
      border-radius: 14px;
      border:1px solid var(--border);
      background: rgba(255,255,255,.04);
      color: var(--text);
    }
    .guide-search i{ opacity:.7; font-size:18px; }
    .guide-search input{
      border:0;
      outline:0;
      width:100%;
      background: transparent;
      color: var(--text);
      font: inherit;
    }
    .guide-search input::placeholder{ color: rgba(255,255,255,.45); }

    .guide-btn{
      padding:10px 12px;
      border-radius:14px;
      border:1px solid var(--border);
      background: rgba(255,255,255,.04);
      color: var(--text);
      cursor:pointer;
      font: inherit;
    }
    .guide-btn:hover{ background: rgba(255,255,255,.06); }

    .chips{ display:flex; flex-wrap:wrap; gap:8px; }
    .chip{
      display:inline-flex;
      align-items:center;
      gap:8px;
      padding:9px 11px;
      border-radius:999px;
      border:1px solid var(--border);
      background: rgba(255,255,255,.04);
      color: var(--text);
      text-decoration:none;
      font-size:14px;
      white-space:nowrap;
    }
    .chip:hover{ background: rgba(255,255,255,.06); }
    .chip.is-active{
      border-color: rgba(255,255,255,.22);
      background: rgba(255,255,255,.08);
      box-shadow: var(--shadow2);
    }

    .sr-only{
      position:absolute;width:1px;height:1px;padding:0;margin:-1px;
      overflow:hidden;clip:rect(0,0,0,0);white-space:nowrap;border:0;
    }

    /* ✅ Search hide class (bulletproof even if [hidden] is overridden elsewhere) */
    [data-episode].is-hidden{ display:none !important; }

    /* ✅ Grid: max 3 cards per row */
    ul.grid{
      list-style:none;
      padding-left:0;
      margin: 12px 0 26px;
      display:grid;
      gap: 14px;
      grid-template-columns: repeat(3, minmax(0, 1fr));
    }
    @media (max-width: 980px){
      ul.grid{ grid-template-columns: repeat(2, minmax(0, 1fr)); }
      #sidebar{ display:none; }
      #main{ width:100%; }
    }
    @media (max-width: 620px){
      ul.grid{ grid-template-columns: 1fr; }
    }

    li.card{
      border-radius: var(--radius);
      overflow:hidden;
      border: 1px solid var(--border);
      background: linear-gradient(180deg, rgba(255,255,255,.08), rgba(255,255,255,.05));
      box-shadow: var(--shadow2);
      display:grid;
      grid-template-rows: auto 1fr;
      transition: transform .12s ease, box-shadow .12s ease, border-color .12s ease;
    }
    li.card:hover{
      transform: translateY(-2px);
      box-shadow: var(--shadow);
      border-color: rgba(255,255,255,.22);
    }
    li.card img{
      width:100%;
      aspect-ratio:16/9;
      object-fit:cover;
      display:block;
      filter: saturate(1.05) contrast(1.02);
    }

    /* Keep content as normal flow so stars don't stack */
    li.card > span{
      display:block;
      padding: 12px 12px 14px;
      color: var(--text);
    }

    .card-title{
      color: var(--text);
      text-decoration:none;
      font-weight: 650;
      letter-spacing: .1px;
      display:block;
      margin-bottom: 6px;
    }
    .card-title:hover{ text-decoration: underline; }
    li.card small{
      display:block;
      margin-bottom: 8px;
      color: var(--muted);
    }

    /* ✅ Force stars inline */
    li.card i.fa-star,
    li.card span i{
      display:inline-block !important;
      vertical-align: middle;
      line-height: 1;
      margin: 0 3px 0 0;
    }
  </style>
</head>

<body>

  <!-- NOTE: You kept your hero and layout as-is in your paste; keep it here exactly -->
  <!-- ... your hero/header markup ... -->

  <!-- Sticky chips + search -->
  <div class="guide-sticky" role="region" aria-label="Browse and search">
    <div class="inner">
      <div class="guide-tools">
        <label class="guide-search">
          <span class="sr-only">Search episodes</span>
          <i class="uil uil-search" aria-hidden="true"></i>
          <input id="episodeSearch" type="search" placeholder="Search episodes… (e.g. Obesity, S28, Episode 3)">
        </label>
        <button class="guide-btn" id="clearSearch" type="button" aria-label="Clear search">Clear</button>
      </div>

      <nav class="chips" aria-label="Browse">
        <a class="chip" href="#s26" data-chip>Season 26</a>
        <a class="chip" href="#s26specials" data-chip>Specials</a>
        <a class="chip" href="#s27" data-chip>Season 27</a>
        <a class="chip" href="#s28" data-chip>Season 28</a>
        <a class="chip" href="#top">Back to top <i class="uil uil-arrow-up" aria-hidden="true"></i></a>
      </nav>
    </div>
  </div>

  <!-- your wrap / sidebar / main content stays exactly as you pasted -->
  <!-- ... your content markup ... -->

  <!-- ✅ Search + chip highlighting (spliced + fixed to use class hide) -->
  <script>
    document.addEventListener('DOMContentLoaded', () => {
      const input = document.getElementById('episodeSearch');
      const clear = document.getElementById('clearSearch');
      const cards = Array.from(document.querySelectorAll('[data-episode]'));

      if (!input || !clear || cards.length === 0) return;

      // Build searchable text (title + small + full text fallback)
      cards.forEach((card) => {
        const title = card.querySelector('.card-title')?.textContent || '';
        const meta  = card.querySelector('small')?.textContent || '';
        const extra = card.textContent || '';
        card.dataset.search = (card.dataset.search || `${title} ${meta} ${extra}`).replace(/\s+/g, ' ').trim();
      });

      function applyFilter() {
        const term = input.value.trim().toLowerCase();
        cards.forEach((card) => {
          const hay = (card.dataset.search || '').toLowerCase();
          const match = !term || hay.includes(term);
          card.classList.toggle('is-hidden', !match);
        });
      }

      input.addEventListener('input', applyFilter);
      clear.addEventListener('click', () => {
        input.value = '';
        applyFilter();
        input.focus();
      });

      // Chip highlight
      const chips = Array.from(document.querySelectorAll('[data-chip]'));
      const sections = chips
        .map(a => document.querySelector(a.getAttribute('href')))
        .filter(Boolean);

      if (chips.length && sections.length) {
        const obs = new IntersectionObserver((entries) => {
          const visible = entries
            .filter(e => e.isIntersecting)
            .sort((a,b) => b.intersectionRatio - a.intersectionRatio)[0];
          if (!visible) return;

          const id = '#' + visible.target.id;
          chips.forEach(c => c.classList.toggle('is-active', c.getAttribute('href') === id));
        }, { rootMargin: "-35% 0px -60% 0px", threshold: [0.1, 0.25, 0.5] });

        sections.forEach(sec => obs.observe(sec));
      }
    });
  </script>

</body>
</html>
