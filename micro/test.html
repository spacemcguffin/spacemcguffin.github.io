<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Notes</title>

<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">

<style>
:root{
  --bg0:#f3f4f8;
  --bg1:#e9ecf6;

  --panel: rgba(255,255,255,.62);
  --panel2: rgba(255,255,255,.42);
  --border: rgba(0,0,0,.10);

  --text:#111111;
  --muted: rgba(17,17,17,.62);
  --muted2: rgba(17,17,17,.45);

  --avatarBg: rgba(0,0,0,.06);

  --glassBlur: 14px;
  --glassSat: 140%;

  --shadow2: 0 10px 30px rgba(0,0,0,.08);

  --maxw: 720px;
  --topbarH: 56px;
}

:root[data-theme="dark"]{
  --bg0:#070814;
  --bg1:#0b1020;

  --panel: rgba(255,255,255,.06);
  --panel2: rgba(255,255,255,.10);
  --border: rgba(255,255,255,.10);

  --text: rgba(255,255,255,.92);
  --muted: rgba(255,255,255,.65);
  --muted2: rgba(255,255,255,.45);

  --avatarBg: rgba(255,255,255,.10);

  --glassBlur: 16px;
  --glassSat: 155%;

  --shadow2: 0 10px 30px rgba(0,0,0,.45);
}

*{box-sizing:border-box;}

body{
  margin:0;
  font-family:'Inter', system-ui, sans-serif;
  color: var(--text);
  -webkit-font-smoothing: antialiased;
  text-rendering: optimizeLegibility;

  background:
    radial-gradient(1200px 700px at 15% 0%, color-mix(in srgb, var(--bg1) 80%, transparent), transparent 60%),
    radial-gradient(900px 600px at 85% 10%, color-mix(in srgb, var(--bg0) 85%, transparent), transparent 60%),
    linear-gradient(180deg, var(--bg0), var(--bg1));
}

/* ===== Top Bar ===== */
.topbar{
  position:fixed;
  top:0; left:0; right:0;
  height:var(--topbarH);
  z-index:100;

  background: var(--panel);
  border-bottom: 1px solid var(--border);
  box-shadow: var(--shadow2);

  backdrop-filter: blur(var(--glassBlur)) saturate(var(--glassSat));
  -webkit-backdrop-filter: blur(var(--glassBlur)) saturate(var(--glassSat));

  display:flex;
  align-items:center;
}

.wrap{
  max-width:var(--maxw);
  margin:0 auto;
  padding:0 16px;
  width:100%;
  display:flex;
  justify-content:space-between;
  align-items:center;
}

.brand{
  font-weight:600;
  font-size:15px;
  display:flex;
  align-items:center;
  gap:8px;
}

.brand__dot{
  width:8px;
  height:8px;
  border-radius:999px;
  background: var(--text);
}

.topbar__right{
  display:flex;
  align-items:center;
  gap:10px;
}

.sortSelect,
.themeBtn{
  height:34px;
  border-radius:999px;
  border:1px solid var(--border);
  background: var(--panel2);
  color: var(--text);
  padding:0 14px;
  font-size:13px;
  cursor:pointer;

  backdrop-filter: blur(var(--glassBlur)) saturate(var(--glassSat));
  -webkit-backdrop-filter: blur(var(--glassBlur)) saturate(var(--glassSat));
}

:root[data-theme="dark"] select option{
  background-color: #0b1020;
  color: rgba(255,255,255,.92);
}
:root:not([data-theme="dark"]) select option{
  background-color: #ffffff;
  color: #111111;
}

.backToTop{
  opacity:0;
  pointer-events:none;
  transition:opacity .2s ease;
}
.backToTop.visible{
  opacity:1;
  pointer-events:auto;
}

.topInset{ height: var(--topbarH); }

/* ===== Layout ===== */
.layout{
  max-width:var(--maxw);
  margin:0 auto;
  padding:0 16px 40px;
}

.timelineHead{
  padding:20px 0 10px;
}

h1{
  margin:0;
  font-size:20px;
  font-weight:600;
}

.subtitle{
  margin-top:4px;
  font-size:13px;
  color:var(--muted);
}

/* ===== Controls ===== */
.controls{
  display:flex;
  gap:8px;
  flex-wrap:wrap;
  margin-top:14px;

  /* Fix A */
  position:relative;
  isolation:isolate;
}

.input,.select{
  height:38px;
  border-radius:10px;
  border:1px solid var(--border);
  background: var(--panel2);
  color: var(--text);
  padding:0 12px;
  font-size:14px;

  backdrop-filter: blur(var(--glassBlur)) saturate(var(--glassSat));
  -webkit-backdrop-filter: blur(var(--glassBlur)) saturate(var(--glassSat));

  /* Fix A */
  background-clip: padding-box;
  overflow:hidden;
}

.btn{
  height:38px;
  border-radius:999px;
  border:1px solid var(--border);
  background: var(--panel2);
  color: var(--text);
  padding:0 14px;
  font-size:14px;
  cursor:pointer;

  backdrop-filter: blur(var(--glassBlur)) saturate(var(--glassSat));
  -webkit-backdrop-filter: blur(var(--glassBlur)) saturate(var(--glassSat));

  /* Fix A */
  background-clip: padding-box;
  overflow:hidden;
}

/* Fix C: consistent select + custom arrow */
.select{
  appearance:none;
  -webkit-appearance:none;
  -moz-appearance:none;

  background-image:
    linear-gradient(45deg, transparent 50%, var(--muted) 50%),
    linear-gradient(135deg, var(--muted) 50%, transparent 50%);
  background-position:
    calc(100% - 18px) 52%,
    calc(100% - 12px) 52%;
  background-size:6px 6px, 6px 6px;
  background-repeat:no-repeat;
  padding-right:34px;
}

/* ===== Feed ===== */
.feed{ margin-top:14px; position:relative; }

/* subtle background glow behind cards */
.feed::before{
  content:"";
  position:absolute;
  inset:-40px -20px;
  z-index:-1;
  background:
    radial-gradient(600px 300px at 20% 0%, rgba(120,160,255,.15), transparent 60%),
    radial-gradient(500px 400px at 80% 10%, rgba(180,120,255,.15), transparent 60%);
  pointer-events:none;
}

/* ===== POSTS AS SOFT FLOATING GLASS CARDS ===== */
.post{
  display:grid;
  grid-template-columns:46px 1fr;
  gap:12px;

  padding:14px 14px;
  margin: 12px 0;

  border: 1px solid var(--border);
  border-radius: 18px;

  background: var(--panel2);

  box-shadow:
    0 14px 35px rgba(0,0,0,.08),
    inset 0 1px 0 rgba(255,255,255,.35);

  backdrop-filter: blur(var(--glassBlur)) saturate(var(--glassSat));
  -webkit-backdrop-filter: blur(var(--glassBlur)) saturate(var(--glassSat));

  position:relative;
  overflow:hidden;
}

/* keep hover calm: no lift, no sheen */
:root[data-theme="dark"] .post{
  box-shadow:
    0 18px 45px rgba(0,0,0,.45),
    inset 0 1px 0 rgba(255,255,255,.06);
}

.post__avatar{
  width:38px;
  height:38px;
  border-radius:999px;
  background: var(--avatarBg);
  display:flex;
  align-items:center;
  justify-content:center;
  font-weight:600;
  font-size:13px;
  overflow:hidden;
  border: 1px solid color-mix(in srgb, var(--border) 80%, transparent);
}

.post__avatar img{
  width:100%;
  height:100%;
  object-fit:cover;
}

.post__top{
  display:flex;
  gap:8px;
  align-items:center;
  flex-wrap:wrap;
}

.post__name{
  font-weight:600;
  font-size:14px;
}

.post__time{
  font-size:13px;
  color:var(--muted2);
}

.post__text{
  margin:6px 0 10px;
  line-height:1.6;
  font-size:15px;
  white-space:pre-wrap;
}

/* ===== Media ===== */
.media{
  margin-top:10px;
  display:grid;
  gap:8px;
}
.media.cols-1{ grid-template-columns:1fr; }
.media.cols-2{ grid-template-columns:repeat(2,1fr); }
.media.cols-3{ grid-template-columns:repeat(2,1fr); }
.media.cols-4{ grid-template-columns:repeat(2,1fr); }

.media.cols-3 .media__item:first-child{
  grid-column:1 / -1;
}

.media__item{
  border-radius:14px;
  overflow:hidden;

  border:1px solid rgba(0,0,0,.08);
  background: rgba(255,255,255,.35);

  box-shadow:
    inset 0 2px 6px rgba(0,0,0,.08),
    inset 0 1px 0 rgba(255,255,255,.5);

  cursor:pointer;
  aspect-ratio: var(--ar, 16/10);

  transition: transform .2s ease;

  backdrop-filter: blur(var(--glassBlur)) saturate(var(--glassSat));
  -webkit-backdrop-filter: blur(var(--glassBlur)) saturate(var(--glassSat));
}

.media__item:hover{
  transform: scale(1.02);
}

:root[data-theme="dark"] .media__item{
  border:1px solid rgba(255,255,255,.08);
  background: rgba(255,255,255,.04);
  box-shadow:
    inset 0 2px 8px rgba(0,0,0,.6),
    inset 0 1px 0 rgba(255,255,255,.05);
}

.media__item img{
  width:100%;
  height:100%;
  object-fit:cover;
  display:block;
  transform:scale(1);
  transition:transform .25s ease;
}
.media__item:hover img{ transform:scale(1.03); }

.tags{
  display:flex;
  gap:8px;
  flex-wrap:wrap;
  margin-top:10px;
}

.tagBtn{
  font-size:12px;
  border:1px solid var(--border);
  background: var(--panel2);
  color: var(--muted);
  padding:5px 10px;
  border-radius:999px;
  cursor:pointer;

  backdrop-filter: blur(var(--glassBlur)) saturate(var(--glassSat));
  -webkit-backdrop-filter: blur(var(--glassBlur)) saturate(var(--glassSat));

  background-clip: padding-box;
  overflow:hidden;
}

.footerRow{
  display:flex;
  justify-content:center;
  align-items:center;
  gap:12px;
  margin-top:20px;
  flex-wrap:wrap;
}

.counter{
  font-size:13px;
  color: var(--muted);
}

.empty{
  padding:30px 0;
  text-align:center;
  color:var(--muted);
}

/* ===== Lightbox ===== */
.lightbox{
  position:fixed;
  inset:0;
  z-index:999;
  display:none;
  align-items:center;
  justify-content:center;
  padding:22px;
  background: rgba(0,0,0,.65);
}
.lightbox.open{ display:flex; }

.lightbox__inner{
  max-width:min(980px, 96vw);
  max-height:86vh;
  border-radius:18px;
  overflow:hidden;
  border:1px solid rgba(255,255,255,.12);
  box-shadow: 0 30px 90px rgba(0,0,0,.6);
  background: rgba(10,12,18,.35);
  backdrop-filter: blur(10px);
}

.lightbox__inner img{
  display:block;
  width:100%;
  height:100%;
  object-fit:contain;
  background:#000;
}

.lightbox__close{
  position:fixed;
  top: calc(var(--topbarH) + 14px);
  right: 16px;
  z-index:1000;
  height:34px;
  border-radius:999px;
  border:1px solid rgba(255,255,255,.18);
  background: rgba(0,0,0,.35);
  color: rgba(255,255,255,.92);
  padding:0 14px;
  font-size:13px;
  cursor:pointer;
  backdrop-filter: blur(10px);
}
</style>
</head>

<body>

<header class="topbar">
  <div class="wrap">
    <div class="brand">
      <span class="brand__dot"></span>
      Notes
    </div>

    <div class="topbar__right">
      <select id="sortSelect" class="sortSelect" aria-label="Sort">
        <option value="new">Newest first</option>
        <option value="old">Oldest first</option>
      </select>

      <button id="themeToggle" class="themeBtn" type="button">Dark</button>
      <button id="backToTop" class="themeBtn backToTop" type="button">↑ Top</button>
    </div>
  </div>
</header>

<div class="topInset" aria-hidden="true"></div>

<main class="layout">

<section id="pageHeader" class="timelineHead">
  <h1>Notes</h1>
  <div class="subtitle">Short-form writing, minimal and chronological.</div>

  <div class="controls">
    <input id="q" class="input" type="search" placeholder="Search…" />
    <select id="tag" class="select">
      <option value="">All tags</option>
    </select>
    <button id="clear" class="btn" type="button">Clear</button>
  </div>
</section>

<div id="feed" class="feed"></div>

<div class="footerRow">
  <span id="counter" class="counter">Showing 0 of 0 posts</span>
  <button id="more" class="btn" type="button">Load more</button>
</div>

</main>

<!-- Lightbox -->
<div id="lightbox" class="lightbox" aria-hidden="true">
  <button id="lbClose" class="lightbox__close" type="button">Close</button>
  <div class="lightbox__inner">
    <img id="lbImg" alt="">
  </div>
</div>

<script>
const posts=[
  {
    date:"2026-03-01T12:40:00Z",
    name:"Lewis",
    avatar:"https://lewis.lc/wiki/img/fractalavatar.png",
    text:"Building a minimal self-hosted microblog.\nFeels calm. Feels permanent.",
    tags:["web","notes"],
    media:[
      "https://lewis.lc/wiki/img/episodes/twith.png"
    ]
  },
  {
    date:"2026-02-28T18:10:00Z",
    name:"Lewis Maddox",
    avatarText:"LM",
    text:"No algorithms.\nJust reverse chronological order.",
    tags:["writing","notes"]
  },
  {
    date:"2026-03-01T20:15:00Z",
    name:"Lewis",
    avatarText:"LM",
    text:"Tiny rule for myself: if a thought fits in one breath, it belongs here.",
    tags:["writing","notes"]
  },
  {
    date:"2026-03-02T09:05:00Z",
    name:"Lewis",
    avatar:"https://lewis.lc/wiki/img/fractalavatar.png",
    text:"Moodboard grab from Lewflix. The glass look really works with bold thumbnails.",
    tags:["web","design"],
    media:[
      "https://lewis.lc/wiki/img/episodes/twith.png",
      "https://lewis.lc/wiki/img/episodes/sns.png"
    ]
  },
  {
    date:"2026-03-02T13:45:00Z",
    name:"Lewis Maddox",
    avatarText:"LM",
    text:"Testing mixed media layouts — single image posts should feel calm, not ‘gallery’.",
    tags:["notes","layout"],
    media:"https://lewis.lc/wiki/img/episodes/tt.png"
  },
  {
    date:"2026-03-02T18:30:00Z",
    name:"Lewis",
    avatar:"https://lewis.lc/wiki/img/fractalavatar.png",
    text:"Four-card layout test from Lewflix. Mixed thumbnails, still balanced.",
    tags:["web","design","lewflix"],
    media:[
      "https://lewis.lc/wiki/img/episodes/tc.png",
      "https://lewis.lc/wiki/img/episodes/twith.png",
      "https://lewis.lc/wiki/img/episodes/sns.png",
      "https://lewis.lc/wiki/img/episodes/tco.png"
    ]
  }
];

const PAGE_SIZE=10;
let visible=PAGE_SIZE;
let currentSort="new";

const feed=document.getElementById("feed");
const q=document.getElementById("q");
const tagSelect=document.getElementById("tag");
const more=document.getElementById("more");
const clear=document.getElementById("clear");
const sortSelect=document.getElementById("sortSelect");
const counter=document.getElementById("counter");
const backToTop=document.getElementById("backToTop");
const pageHeader=document.getElementById("pageHeader");

/* Lightbox */
const lightbox=document.getElementById("lightbox");
const lbImg=document.getElementById("lbImg");
const lbClose=document.getElementById("lbClose");

function openLightbox(src){
  lbImg.src = src;
  lightbox.classList.add("open");
  lightbox.setAttribute("aria-hidden","false");
}
function closeLightbox(){
  lightbox.classList.remove("open");
  lightbox.setAttribute("aria-hidden","true");
  lbImg.src = "";
}
lbClose.addEventListener("click", closeLightbox);
lightbox.addEventListener("click", (e)=>{ if(e.target === lightbox) closeLightbox(); });
window.addEventListener("keydown", (e)=>{ if(e.key === "Escape") closeLightbox(); });

/* Populate tags */
function populateTags(){
  const tagSet=new Set();
  posts.forEach(p=>(p.tags||[]).forEach(t=>tagSet.add(String(t).toLowerCase())));
  const sortedTags=[...tagSet].filter(Boolean).sort();
  tagSelect.innerHTML='<option value="">All tags</option>'+
    sortedTags.map(t=>`<option value="${t}">#${t}</option>`).join("");
}
populateTags();

/* Theme */
const root=document.documentElement;
const themeBtn=document.getElementById("themeToggle");
function applyTheme(theme){
  root.setAttribute("data-theme",theme);
  themeBtn.textContent=theme==="dark"?"Light":"Dark";
}
themeBtn.onclick=()=>{
  const next=root.getAttribute("data-theme")==="dark"?"light":"dark";
  localStorage.setItem("theme",next);
  applyTheme(next);
};
applyTheme(localStorage.getItem("theme")||"light");

/* Back to top: show only after passing header section */
let headerTriggerY = 0;
function computeHeaderTrigger(){
  const rect = pageHeader.getBoundingClientRect();
  headerTriggerY = window.scrollY + rect.bottom - 8;
}
function updateBackToTop(){
  if(window.scrollY > headerTriggerY){
    backToTop.classList.add("visible");
  } else {
    backToTop.classList.remove("visible");
  }
}
window.addEventListener("resize", () => { computeHeaderTrigger(); updateBackToTop(); });
window.addEventListener("scroll", updateBackToTop);
backToTop.onclick=()=> window.scrollTo({top:0,behavior:"smooth"});

/* Utilities */
function initials(name=""){
  return name.split(" ").filter(Boolean).map(n=>n[0]).join("").slice(0,2).toUpperCase();
}
function avatar(p){
  if(p.avatar) return `<img src="${p.avatar}" alt="">`;
  if(p.avatarText) return p.avatarText;
  return initials(p.name);
}
function relativeTime(iso){
  const now=new Date(), d=new Date(iso);
  const diff=(now-d)/1000;
  if(diff<15) return "now";
  if(diff<60) return Math.floor(diff)+"s";
  if(diff<3600) return Math.floor(diff/60)+"m";
  if(diff<86400) return Math.floor(diff/3600)+"h";
  const days=Math.floor(diff/86400);
  if(days===1) return "Yesterday";
  if(days<7) return days+"d";
  return d.toLocaleDateString(undefined,{month:"short",day:"numeric"});
}
function getSorted(){
  return [...posts].sort((a,b)=>
    currentSort==="new"
      ? new Date(b.date)-new Date(a.date)
      : new Date(a.date)-new Date(b.date)
  );
}

/* Media rendering */
function renderMedia(p){
  const arr = Array.isArray(p.media) ? p.media : (p.media ? [p.media] : []);
  if(!arr.length) return "";
  const n = Math.min(arr.length, 4);
  const cls = n===1 ? "cols-1" : n===2 ? "cols-2" : n===3 ? "cols-3" : "cols-4";
  return `
    <div class="media ${cls}" data-count="${n}">
      ${arr.slice(0,4).map(src=>`
        <div class="media__item" role="button" tabindex="0" data-media="${src}">
          <img src="${src}" alt="" loading="lazy">
        </div>
      `).join("")}
    </div>
  `;
}

/* Auto-detect aspect ratio for media images */
function applyMediaAspectRatios(){
  const imgs = feed.querySelectorAll(".media__item img");
  imgs.forEach(img=>{
    if(img.dataset.arDone) return;
    img.dataset.arDone = "1";

    const apply = ()=>{
      const w = img.naturalWidth || 0;
      const h = img.naturalHeight || 0;
      if(w && h){
        const ar = (w / h);
        img.parentElement.style.setProperty("--ar", ar.toFixed(4));
      }
    };

    if(img.complete) apply();
    else img.addEventListener("load", apply, { once:true });
  });
}

/* Render */
function render(reset=false){
  if(reset) visible=PAGE_SIZE;

  const sorted=getSorted();
  const filtered=sorted.filter(p=>{
    const query=(q.value||"").toLowerCase();
    const tag=(tagSelect.value||"").toLowerCase();
    const text=(p.text||"").toLowerCase();
    const tags=(p.tags||[]).map(t=>String(t).toLowerCase());
    return (!query||text.includes(query)) && (!tag||tags.includes(tag));
  });

  const total=filtered.length;
  const shown=Math.min(visible,total);
  counter.textContent=`Showing ${shown} of ${total} posts`;

  const slice=filtered.slice(0,visible);

  feed.innerHTML = slice.length ? slice.map(p=>`
    <article class="post">
      <div class="post__avatar">${avatar(p)}</div>
      <div>
        <div class="post__top">
          <div class="post__name">${p.name}</div>
          <div class="post__time">· ${relativeTime(p.date)}</div>
        </div>
        <div class="post__text">${p.text}</div>
        ${renderMedia(p)}
        ${(p.tags||[]).length?`
          <div class="tags">
            ${p.tags.map(t=>`<button class="tagBtn" type="button" data-tag="${t}">#${t}</button>`).join("")}
          </div>`:""}
      </div>
    </article>
  `).join("") : `<div class="empty">No posts found.</div>`;

  more.style.display = total > visible ? "block" : "none";

  computeHeaderTrigger();
  updateBackToTop();
  applyMediaAspectRatios();
}

/* Events */
feed.addEventListener("click",(e)=>{
  const t=e.target?.dataset?.tag;
  if(t){
    tagSelect.value=String(t).toLowerCase();
    render(true);
    return;
  }
  const media = e.target?.closest?.("[data-media]")?.dataset?.media;
  if(media) openLightbox(media);
});

feed.addEventListener("keydown",(e)=>{
  if(e.key !== "Enter") return;
  const media = e.target?.dataset?.media;
  if(media) openLightbox(media);
});

sortSelect.onchange=e=>{ currentSort=e.target.value; render(true); };
q.oninput=()=>render(true);
tagSelect.onchange=()=>render(true);
more.onclick=()=>{ visible+=PAGE_SIZE; render(); };
clear.onclick=()=>{ q.value=""; tagSelect.value=""; render(true); };

/* Init */
render(true);
computeHeaderTrigger();
updateBackToTop();
</script>

</body>
</html>
